<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/css/hsimp.css">
</head>
<body>
    <form>
        <h2>회원가입 정보 입력</h2>
        <hr class="rounded">
        <div>
            <div class="form-group">
                <label for="mail-box">이메일</label>
                <input type="text" name="mail" id="mail-box" class="form-control" placeholder="Your Email" />
            </div>
            <hr class="rounded">
            <div class="form-group">
                <label for="name-box">닉네임</label>
                <input type="text" name="name" id="name-box" class="form-control" placeholder="Username" />
            </div>
            <hr class="rounded">
            <div class="form-group">
                <label for="password-box">비밀번호</label>
                <input type="password" name="password" id="password-box" class="form-control" placeholder="Password"/>
                <div id="password-time" class="hsimp-time"></div>
                <ul id="password-checks" class="hsimp-checks"></ul>
            </div>
            <div class="form-group">
                <label for="password-box-2">비밀번호 확인</label>
                <input type="password" id="password-box-2" class="form-control" placeholder="Confirm the Password"/>
            </div>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <div id="name-btn-status">
                <button class="btn btn-outline-success register" data-oper="done">가입하기</button><a href="/" class="btn btn-danger">취소하기</a>
            </div>
        </div>
    </form>
    <script>
        $(document).ready(function() {
            var formObj = $("form");
            const nameTest = /^[가-힣a-zA-Z0-9]{2,15}$/i;
            
            var mailTest = /^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*.[a-zA-Z]{2,3}$/i;
            
            const passvalue = "form-control hsimp-level hsimp-level--good";
            
            $('.register').on("click", function (e) {
                const mailOrigin = document.querySelector("#mail-box");
                const maildomain = mailOrigin.value.split("@");
                
                const name = document.querySelector("#name-box");
                
                const passval1 = document.querySelector("#password-box");
                const passval2 = document.querySelector("#password-box-2");
                const testClass = passval1.className;

                e.preventDefault();
                var operation = $(this).data("oper");
                formObj.attr("method", "post");

                console.log(maildomain[0]);
                console.log(maildomain[1]);
                console.log(nameTest.test(name.value));
        
                if(operation === "done") {
                    if(mailTest.test(mailOrigin.value) == false) {
                        alert("이메일 주소를 정확하게 입력해주세요.");
                    } else if (maildomain[1] != "naver.com" && maildomain[1] != "daum.net" && maildomain[1] != "gmail.com" && maildomain[1] != "kakao.com") {
                        alert("해당 이메일은 사이트 내에서 허용되지 않는 이메일입니다.");
                    } else if (nameTest.test(name.value) != true) {
                        alert("닉네임을 입력해주세요.");
                    } else if (passval1.value == null || passval1.value == undefined || passval1 == "") {
                        alert("비밀번호를 입력하세요.");
                    } else if (testClass != passvalue) {
                        alert("비밀번호의 보안 강도가 낮습니다!");
                    } else if (passval1.value != passval2.value) {
                        alert("비밀번호가 서로 다릅니다.");
                    }
                }
            });
        });
    </script>
    <script src="/js/hsimp.min.js"></script>
    <script src="/js/hsimp.sub.js"></script>
</body>
</html>